<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Nextflow - Vulture Tutorial</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Nextflow";
        var mkdocs_page_input_path = "1. Running on local computer/3_Nextflow.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Vulture Tutorial
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Welcome</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">1. Running on local computer</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../1_Quickstart/">Quick start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../2_Commandline/">Command line tool parameters</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Nextflow</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#install-java-and-nextflow">Install Java and Nextflow</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#specify-the-local-envrionment-in-the-nextflow-config-file">Specify the local envrionment in the Nextflow config file</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#specify-the-configuration-file-for-an-analysis-reading-files-from-the-local-computer">Specify the configuration file for an analysis reading files from the local computer</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#specify-the-configuration-file-for-an-analysis-reading-files-from-the-sra-database">Specify the configuration file for an analysis reading files from the SRA database</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../4_Docker/">Docker</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">2. Running on AWS Cloud</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../2.%20Running%20on%20AWS%20Cloud/1_Setup/">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../2.%20Running%20on%20AWS%20Cloud/2_Nextflow/">Nextflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../2.%20Running%20on%20AWS%20Cloud/3_Batch/">Batch</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../2.%20Running%20on%20AWS%20Cloud/4_RunVulture/">Running Vulture on AWS cloud with Nextflow</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">3. Building your reference genome</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../3.%20Building%20your%20reference%20genome/1_Build/">Build our own reference genome</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Supplementary</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Supplementary/Launchtemp/">Launch template Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Supplementary/Supplementary/">Supplementary</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Vulture Tutorial</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>1. Running on local computer &raquo;</li>
      <li>Nextflow</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="run-vulture-on-local-machines-using-nextflow">Run Vulture on local machines using Nextflow</h1>
<p>The instructions are tested on the following system:</p>
<pre><code class="language-shell">Distributor ID: Ubuntu
Description:    Ubuntu 22.04.2 LTS
Release:        22.04
Codename:       jammy
</code></pre>
<h2 id="requirements"><a name="require"></a>Requirements</h2>
<ul>
<li>Input data: 10x Chromium scRNA-seq reads</li>
<li>Nextflow &lt;= v22.10.0</li>
<li>R &gt;= v4.0.0</li>
<li>DropletUtils &gt;= v1.10.2</li>
<li>Samtools &gt;= v1.13</li>
<li>STAR &gt;= v2.7.9a or</li>
<li>cellranger &gt;= 6.0.0 or</li>
<li>Kallisto/bustools &gt;= 0.25.1 or</li>
<li>salmon/alevin &gt;= v1.4.0</li>
</ul>
<h2 id="install-java-and-nextflow">Install Java and Nextflow</h2>
<p>Nextflow is a workflow manager that enables the development of portable and reproducible workflows. It supports deploying workflows on a variety of execution platforms including local, HPC schedulers, AWS Batch, Google Cloud Life Sciences, Kubernetes, Slurm, Singularity, PBS, LSF, among others. It also supports most popular cluster schedulers including SGE, SLURM, PBS, LSF, IBM Spectrum LSF, Sun Grid Engine, HTCondor, among others.
We apply Nextflow v22.10.tar.gz in this tutorial because it is the latest version that is compatible with the Vulture pipeline.</p>
<pre><code class="language-sh">## Install Java
sudo apt install default-jdk

## Install nextflow 22.10.0
wget https://github.com/nextflow-io/nextflow/archive/refs/tags/v22.10.0.tar.gz
tar xvf v22.10.0.tar.gz
cd nextflow-22.10.0/
echo &quot;export PATH=/home/ubuntu/nextflow-22.10.0:\$PATH&quot; &gt;&gt; ~/.bashrc
sudo apt-get install -y graphviz jq
</code></pre>
<h2 id="specify-the-local-envrionment-in-the-nextflow-config-file">Specify the local envrionment in the Nextflow config file</h2>
<p>Open the "nextflow.config" file in the vulture/nextflow directory. This following snippet shows how to disable the docker container for the pipeline.</p>
<pre><code class="language-shell">...
batchlocal {
    docker.enabled = false
}
...

</code></pre>
<h2 id="specify-the-configuration-file-for-an-analysis-reading-files-from-the-local-computer">Specify the configuration file for an analysis reading files from the local computer</h2>
<p>Before we start our analysis, we need to creat a configuration file for the analysis. Here is a snippet of how the "params.yaml" file looks like:</p>
<pre><code class="language-shell">...
soloStrand: &quot;Forward&quot;
alignment: &quot;STAR&quot;
technology: &quot;10XV3&quot;
virus_database: &quot;viruSITE.NCBIprokaryotes&quot;
soloMultiMappers: &quot;EM&quot;
soloFeatures: &quot;GeneFull&quot;
inputformat: &quot;fastq&quot;
sampleSubfix1: &quot;_1&quot;
sampleSubfix2: &quot;_2&quot;
codebase: [The path of your vulture directory, e.g. /home/user/vulture]
ref: [The full path of your reference genome direcory, e.g. /home/user/data/references]
samplepath: [The full path of your fastq samples, e.g /home/user/data/fastq]
read2urls:
- [The full path of your _2.fastq.gz file, e.g. /home/user/data/fastq/SRR12570125_2.fastq.gz]
read1urls:
- [The full path of your _1.fastq.gz file, e.g. /home/user/data/fastq/SRR12570125_1.fastq.gz]
reads:
- [An unique ID of your sample, e.g SRR12570125]
...
</code></pre>
<p>Execute the command below to start the main analysis of Vulture.</p>
<pre><code class="language-shell">cd vulture/nextflow
nextflow run scvh_docker_local.nf -profile batchlocal -params-file params.yaml --outdir=your_output_directory -with-report nextflow_report_$(date +%s).html -bg &amp;&gt;&gt; nextflow_log_$(date +%s).log
</code></pre>
<p>A successful run will generate the following files in the output directory:</p>
<pre><code class="language-shell">...
nextflow_report_1628188800.html
nextflow_log_1628188800.log
...
</code></pre>
<p>The "nextflow_report_1628188800.html" file is a report of the analysis. The "nextflow_log_1628188800.log" file is the log file of the analysis. A successful run will also generate the following files in the nextflow_log_1628188800.log:</p>
<pre><code class="language-shell">N E X T F L O W  ~  version 21.10.6
Launching `scvh_docker_local.nf` [cheeky_brown] - revision: 59a6446081
S C V H - N F   P I P E L I N E
===================================
transcriptome: /mnt/d/scvh_files/vmh_genome_dir/references
reads        : [SRR12570125]
outdir       : /mnt/d/output/
database:    : viruSITE.NCBIprokaryotes
threads      : 10 
ram          : 128 
alignment    : STAR 
whitelist    : 3M-february-2018.txt 
soloCBlen    : 16 
soloCBstart  : 1 
soloUMIstart : 17 
soloUMIlen   : 12 
soloStrand   : Forward 
soloMultiMappers: EM 
soloFeature : GeneFull 
outSAMtype   : BAM SortedByCoordinate 
technology   : 10XV3 
pseudoBAM    : 
inputformat    : fastq 
sampleSubfix1    : _1 
sampleSubfix2    : _2 

[SRR12570125, /mnt/d/scvh_files/EXAMPLES/SRR12570125_1.fastq.gz, /mnt/d/scvh_files/EXAMPLES/SRR12570125_2.fastq.gz]
[88/9dd405] Submitted process &gt; Map (1)
...
Completed at: 14-Jul-2023 16:56:53
Duration    : 16m 8s
CPU hours   : 57.6 (1.4% failed)
Succeeded   : 3

</code></pre>
<h2 id="specify-the-configuration-file-for-an-analysis-reading-files-from-the-sra-database">Specify the configuration file for an analysis reading files from the SRA database</h2>
<p>Alternatively, you can also download the fastq files from the SRA database. Here is a snippet of how the "params.yaml" file looks like:</p>
<pre><code class="language-shell">alignment: STAR
codebase: [The full path of your Vulture direcory, e.g. /home/user/code/Vulture]
inputformat: fastq
ram: 128
ref: [The full path of your reference genome direcory, e.g. /home/user/data/references]
reads:
- SRR14736914
- SRR14736920
- SRR14736921
- SRR14736923
- SRR14736925
- SRR14736934
- SRR14736927
- SRR14736936
soloFeatures: GeneFull
soloStrand: Reverse
technology: 10XV3
virus_database: viruSITE.NCBIprokaryotes
</code></pre>
<p>Execute the command below to start the main analysis of Vulture.</p>
<pre><code class="language-shell">cd vulture/nextflow
nextflow run scvh_full_local.nf -profile batchlocal -params-file params.yaml --outdir=your_output_directory -with-report nextflow_report_$(date +%s).html -bg &amp;&gt;&gt; nextflow_log_$(date +%s).log
</code></pre>
<p>The analysis will launch the SRA-tools and dump fastq files from the SRA database and start the analysis. A successful run will generate the following files in the output directory:</p>
<pre><code class="language-shell">N E X T F L O W  ~  version 21.10.6
Launching `scvh_full_local.nf` [backstabbing_austin] - revision: a459ae3e2c
S C V H - N F   P I P E L I N E
===================================
transcriptome: [The full path of your Vulture direcory, e.g. /home/user/code/Vulture]
reads        : [SRR14736914, SRR14736920, SRR14736921, SRR14736923, SRR14736925, SRR14736934, SRR14736927, SRR14736936]
outdir       : [The full path of your Vulture direcory, e.g. /home/user/output/Vulture]
database:    : viruSITE.NCBIprokaryotes
threads      : 10 
ram          : 128 
alignment    : STAR 
whitelist    : 3M-february-2018.txt 
soloCBlen    : 16 
soloCBstart  : 1 
soloUMIstart : 17 
soloUMIlen   : 12 
soloStrand   : Reverse 
soloMultiMappers: EM 
soloFeature : GeneFull 
outSAMtype   : BAM SortedByCoordinate 
technology   : 10XV3 
pseudoBAM    : 
inputformat    : fastq 
sampleSubfix1    : _1 
sampleSubfix2    : _2 

SRR14736914
SRR14736920
SRR14736921
SRR14736923
SRR14736925
SRR14736934
SRR14736927
SRR14736936
executor &gt;  local (1)
[2f/894239] process &gt; Dump (6) [  0%] 0 of 8
[-        ] process &gt; Map      -
[-        ] process &gt; Filter   -
[-        ] process &gt; Analysis -

executor &gt;  local (1)
[2f/894239] process &gt; Dump (6) [  0%] 0 of 8
[-        ] process &gt; Map      -
[-        ] process &gt; Filter   -
[-        ] process &gt; Analysis -

executor &gt;  local (2)
[f6/245efd] process &gt; Dump (7) [  0%] 0 of 8
[-        ] process &gt; Map      -
[-        ] process &gt; Filter   -
[-        ] process &gt; Analysis -

executor &gt;  local (2)
[2f/894239] process &gt; Dump (6) [ 12%] 1 of 8
[-        ] process &gt; Map      -
[-        ] process &gt; Filter   -
[-        ] process &gt; Analysis -

executor &gt;  local (2)
[2f/894239] process &gt; Dump (6) [ 12%] 1 of 8
[-        ] process &gt; Map      -
[-        ] process &gt; Filter   -
[-        ] process &gt; Analysis -

executor &gt;  local (2)
[2f/894239] process &gt; Dump (6) [ 12%] 1 of 8
[-        ] process &gt; Map      [  0%] 0 of 1
[-        ] process &gt; Filter   -
[-        ] process &gt; Analysis -

....

Completed at: 14-Jul-2023 16:56:53
Duration    : 3h 36m 8s
CPU hours   : 57.6 (1.4% failed)
Succeeded   : 8
Ignored     : 8
Failed      : 8
</code></pre>
<div class="code-example" markdown="1">
[Previous Step](https://juychen.github.io/docs/3_Nextflow/NextflowInstall.html){: .btn }
[Next Step](https://juychen.github.io/docs/6_Local/Localusage.html){: .btn .btn-purple }
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../2_Commandline/" class="btn btn-neutral float-left" title="Command line tool parameters"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../4_Docker/" class="btn btn-neutral float-right" title="Docker">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../2_Commandline/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../4_Docker/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
